<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" type="text/css" href="styles.css">
</head>
<body>
  <div id="tabs">
    <button class="tab-button" onclick="showTab('main')">Main</button>
    <button class="tab-button" onclick="showTab('comaruFamily')">Comaru Family</button>
    <button class="tab-button" onclick="showTab('pig')">Pig</button>
    <button class="tab-button" onclick="showTab('others')">Others</button>
  </div>
  <h2>File Upload</h2>
  <form action="/upload" method="post" enctype="multipart/form-data">
    <input type="file" name="file">
    <input type="submit" value="Upload File">
  </form>

  <h2>View GIF</h2>
  <input type="text" id="gifIdInput" placeholder="GIF ID"> <!-- Текстове поле для введення ідентифікатора GIF -->
  <button onclick="openGif()">Open Gif</button>
  <video id="" controls class="styled-video" style="display: none;"></video> <!-- <video> для відображення GIF з класом "styled-video" -->
  <img id="gifImage" style="display: none;"> <!-- <img> для відображення GIF -->
  <div id="contentType"></div>
  <div id="gifIdElement"></div>


  <!--<h2>Download GIF as Text</h2>-->
  <input type="text" id="downloadTextGifId" placeholder="Enter GIF ID"style="display: none;">
  <button onclick="downloadTextGif()" style="display: none;">Download GIF as Text</button>
  <a id="downloadTextLink" style="display: none;">Download GIF as Text</a>

<h2>Download GIF</h2>
<input type="text" id="downloadGifId" placeholder="Enter GIF ID">
<button onclick="downloadGif()">Download GIF</button>

<!-- Додано новий блок для відображення списку гіфок -->
<div class="gif-container">
  <!-- Список GIF і CSS вже включені -->
  <h2>List of GIFs</h2>
  <div class="gif-columns">
    <ul id="gifList"></ul>
  </div>
</div>
<!-- Кінець нового блоку -->

  <script>
    function openGif() {
      console.log('Button clicked'); // Перевірка чи кнопка натиснута
      const gifIdInput = document.getElementById('gifIdInput');
      const gifId = gifIdInput.value; // Отримання ідентифікатор GIF з текстового поля
      const gifImage = document.getElementById('gifImage');
      
      document.getElementById('contentType').textContent = ''; // Очистка contentType
      
      fetch(`/get-gif/${gifId}`)
        .then(response => {
          if (response.status === 404) {
            console.error('GIF not found');
          } else if (!response.ok) {
            console.error('Error fetching GIF:', response.status);
          } else {
            return response.blob();
          }
        })
        .then(blob => {
          if (blob) {
            const gifUrl = URL.createObjectURL(blob);
            gifImage.src = gifUrl;
            gifImage.style.display = 'block';
        console.log(blob);
          }
        })
        .catch(error => {
          console.error('Error fetching GIF:', error);
        });

      fetch(`/get-content-type/${gifId}`) // Відображення contentType
        .then(response => response.text())
        .then(contentType => {
          document.getElementById('contentType').textContent = contentType;
        })
        .catch(error => {
          console.error('Error fetching contentType:', error);
        });
        document.getElementById('gifIdElement').textContent = `GIF ID: ${gifId}`;
    }

    function downloadTextGif() {
  const gifIdInput = document.getElementById('downloadTextGifId');
  const gifId = gifIdInput.value;

  fetch(`/get-gif-text/${gifId}`)
    .then(response => {
      if (response.status === 404) {
        console.error('GIF not found');
      } else if (!response.ok) {
        console.error('Error fetching GIF:', response.status);
      } else {
        return response.text();
      }
    })
    .then(data => {
      if (data) {
        const blob = new Blob([data], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${gifId}.txt`;
        a.style.display = 'none';
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);
      }
    })
    .catch(error => {
      console.error('Error fetching GIF:', error);
    });
}

function downloadGif() {
  const gifIdInput = document.getElementById('downloadGifId');
  const gifId = gifIdInput.value;

  fetch(`/download-gif/${gifId}`)
    .then(response => {
      if (response.status === 404) {
        console.error('GIF not found');
      } else if (!response.ok) {
        console.error('Error fetching GIF:', response.status);
      } else {
        return response.blob();
      }
    })
    .then(blob => {
      if (blob) {
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'downloaded.gif'; // Ім'я файлу для завантаження
        a.style.display = 'none';
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);
      }
    })
    .catch(error => {
      console.error('Error fetching GIF:', error);
    });
}

function displayGifList() {
      const gifList = document.getElementById('gifList');
      gifList.innerHTML = ''; // Очистити список

      // Запит до сервера для отримання списку гіфок
      fetch('/get-gif-list')
        .then(response => response.json())
        .then(data => {
          if (data.length > 0) {
            data.forEach(gif => {
              const listItem = document.createElement('li');
              listItem.innerHTML = `<a href="#" onclick="showGif('${gif._id}')">${gif.filename}</a>`;
              gifList.appendChild(listItem);
            });
          } else {
            gifList.innerHTML = '<li>No GIFs available.</li>';
          }
        })
        .catch(error => {
          console.error('Error fetching GIF list:', error);
        });
    }

    function showGif(gifId) {
      const gifIdInput = document.getElementById('gifIdInput');
      const downloadGifIdInput = document.getElementById('downloadGifId'); // Додайте цей рядок
      const downloadTextGifId = document.getElementById('downloadTextGifId');

      gifIdInput.value = gifId;
      downloadGifIdInput.value = gifId; // Заповнюємо поле для Download ID
      downloadTextGifId.value=gifId;
      openGif();
    }

    displayGifList(); // Виклик функції при завантаженні сторінки для відображення списку гіфок

  </script>
  
</body>
</html>