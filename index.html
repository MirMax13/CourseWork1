<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" type="text/css" href="styles.css">
</head>
<body>
  <div id="tabs">
    <button class="tab-button active-tab" data-tab="main" onclick="showTab('main')">Main</button>
  <button class="tab-button" data-tab="comaruFamily" onclick="showTab('comaruFamily')">Comaru Family</button>
  <button class="tab-button" data-tab="pig" onclick="showTab('pig')">Pig</button>
  <button class="tab-button" data-tab="arctic_vixen" onclick="showTab('arctic_vixen')">Arctic Vixen</button>
  <button class="tab-button" data-tab="others" onclick="showTab('others')">Others</button>

<button class="tab-button" data-tab="searchByName" onclick="showTab('searchByName')">Search by name</button>
<button class="tab-button" data-tab="searchByAttributes" onclick="showTab('searchByAttributes')">Search by attributes</button>
  </div>
  <h2>File Upload</h2>
  <form action="/upload" method="post" enctype="multipart/form-data">
    <input type="file" name="file">
    <input type="submit" value="Upload File">
  </form>

  <h2>View and Download GIF</h2>
  <input type="text" id="gifIdInput" placeholder="GIF ID"> <!-- Текстове поле для введення ідентифікатора GIF -->
  <input type="text" id="downloadFileNameInput" placeholder="Enter file name (in Latin)">
  <button onclick="openGif()">Open GIF</button>
  <button onclick="downloadGif()">Download GIF</button>
  <video id="" controls class="styled-video" style="display: none;"></video> <!-- <video> для відображення GIF з класом "styled-video" -->
  <img id="gifImage" style="display: none;"> <!-- <img> для відображення GIF -->
  <div id="gifAttributes"></div>

  <div class="tab-divider"></div>

<div id="searchByNameTabContent" style="display: none;">
  <input type="text" id="searchByNameInput" placeholder="Enter GIF name">
  <button onclick="searchByName()">Search</button>
</div>

<div id="searchByAttributeTabContent" style="display: none;">
  <input type="text" id="searchByAttributeInput" placeholder="Enter GIF attribute">
  <button onclick="searchByAttribute()">Search</button>
</div>

<!-- Блок для відображення списку Comaru GIFs -->
<div class="gif-container" id="comaruGifContainer" style="display: none;">
  <div class="gif-columns">
    <ul id="comaruGifList"></ul>
  </div>
</div>

<!-- Блок для відображення списку Pig GIFs -->
<div class="gif-container" id="pigGifContainer" style="display: none;">
  <div class="gif-columns">
    <ul id="pigGifList"></ul>
  </div>
</div>

<!-- Блок для відображення списку Others GIFs -->
<div class="gif-container" id="othersGifContainer" style="display: none;">
  <div class="gif-columns">
    <ul id="othersGifList"></ul>
  </div>
</div>

<!-- Блок для відображення списку Arctic_Vixen GIFs -->
<div class="gif-container" id="arctic_vixenGifContainer" style="display: none;">
  <div class="gif-columns">
    <ul id="arctic_vixenGifList"></ul>
  </div>
</div>

<!-- Блок для відображення списку гіфок -->
<div class="gif-container" id="allGifContainer" style="display: none;">
  <h2>List of GIFs</h2>
  <div class="gif-columns">
    <ul id="gifList"></ul>
  </div>
</div>

  <script>
    function openGif() {
      console.log('Button clicked'); // Перевірка чи кнопка натиснута
      const gifIdInput = document.getElementById('gifIdInput');
      const gifId = gifIdInput.value; // Отримання ідентифікатор GIF з текстового поля
      const gifImage = document.getElementById('gifImage');
      fetch(`/gif/${gifId}`)
        .then(response => {
          if (response.status === 404) {
            console.error('GIF not found');
          } else if (!response.ok) {
            console.error('Error fetching GIF:', response.status);
          } else {
            return response.blob();
          }
        })
        .then(blob => {
          if (blob) {
            const gifUrl = URL.createObjectURL(blob);
            gifImage.src = gifUrl;
            gifImage.style.display = 'block';
        console.log(blob);
          }
        })
        .catch(error => {
          console.error('Error fetching GIF:', error);
        }); 
      fetch(`/gif-attributes/${gifId}`) // Отримання атрибутів
          .then(response => response.json())
          .then(attributes => {
            document.getElementById('gifAttributes').textContent = `Attributes: ${attributes.join(', ')}`;
          })
          .catch(error => {
            console.error('Error fetching attributes:', error);
          });
    }

    function downloadGif() {
      const gifIdInput = document.getElementById('gifIdInput');
      const gifId = gifIdInput.value;
      const downloadFileNameInput = document.getElementById('downloadFileNameInput');
      const downloadFileName = downloadFileNameInput.value || 'downloaded.gif';
  
      fetch(`/download-gif/${gifId}?fileName=${downloadFileName}`)
        .then(response => {
          if (response.status === 404) {
            console.error('GIF not found');
          } else if (!response.ok) {
            console.error('Error fetching GIF:', response.status);
          } else {
            return response.blob();
          }
        })
        .then(blob => {
          if (blob) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = downloadFileName;
            a.style.display = 'none';
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
          }
        })
        .catch(error => {
          console.error('Error fetching GIF:', error);
        });
  }

function displayGifList() {
      const allGifContainer = document.getElementById('allGifContainer');
      allGifContainer.style.display = 'block'; 

      const gifList = document.getElementById('gifList');
      gifList.innerHTML = ''; // Очистити список

      // Запит до сервера для отримання списку гіфок
      fetch('/gif-list')
        .then(response => response.json())
        .then(data => {
          if (data.length > 0) {
            data.forEach(gif => {
              const listItem = document.createElement('li');
              listItem.innerHTML = `<a href="#" onclick="showGif('${gif._id}')">${gif.filename}</a>`;
              gifList.appendChild(listItem);
            });
          } else {
            gifList.innerHTML = '<li>No GIFs available.</li>';
          }
        })
        .catch(error => {
          console.error('Error fetching GIF list:', error);
        });
    }

    function showGif(gifId) {
      const gifIdInput = document.getElementById('gifIdInput');
      gifIdInput.value = gifId;
      openGif();
    }

    displayGifList(); // Виклик функції при завантаженні сторінки для відображення списку гіфок
    function displayComaruGifList() {
      const comaruGifContainer = document.getElementById('comaruGifContainer');
      comaruGifContainer.style.display = 'block'; // Показати контейнер для Comaru GIFs

      const gifList = document.getElementById('gifList');
      gifList.innerHTML = ''; // Очистити список

      // Запит до сервера для отримання списку "Comaru" гіфок
      fetch('/Comaru-gif-list')
        .then(response => response.json())
        .then(data => {
          if (data.length > 0) {
            data.forEach(gif => {
              const listItem = document.createElement('li');
              listItem.innerHTML = `<a href="#" onclick="showGif('${gif._id}')">${gif.filename}</a>`;
              gifList.appendChild(listItem);
            });
          } else {
            gifList.innerHTML = '<li>No "Comaru" GIFs available.</li>';
          }
        })
        .catch(error => {
          console.error('Error fetching "Comaru" GIF list:', error);
        });
    }
  function displayPigGifList() {
      const pigGifContainer = document.getElementById('pigGifContainer');
      pigGifContainer.style.display = 'block'; // Показати контейнер для pig GIFs

      const gifList = document.getElementById('gifList');
      gifList.innerHTML = ''; // Очистити список

      // Запит до сервера для отримання списку "pig" гіфок
      fetch('/Pig-gif-list')
        .then(response => response.json())
        .then(data => {
          if (data.length > 0) {
            data.forEach(gif => {
              const listItem = document.createElement('li');
              listItem.innerHTML = `<a href="#" onclick="showGif('${gif._id}')">${gif.filename}</a>`;
              gifList.appendChild(listItem);
            });
          } else {
            gifList.innerHTML = '<li>No "others" GIFs available.</li>';
          }
        })
        .catch(error => {
          console.error('Error fetching "others" GIF list:', error);
        });
    }
  function displayArctic_VixenGifList() {
      const arctic_vixenGifContainer = document.getElementById('arctic_vixenGifContainer');
      arctic_vixenGifContainer.style.display = 'block'; // Показати контейнер для pig GIFs

      const gifList = document.getElementById('gifList');
      gifList.innerHTML = ''; // Очистити список

      // Запит до сервера для отримання списку "arctic_vixen" гіфок
      fetch('/Arctic_Vixen-gif-list')
        .then(response => response.json())
        .then(data => {
          if (data.length > 0) {
            data.forEach(gif => {
              const listItem = document.createElement('li');
              listItem.innerHTML = `<a href="#" onclick="showGif('${gif._id}')">${gif.filename}</a>`;
              gifList.appendChild(listItem);
            });
          } else {
            gifList.innerHTML = '<li>No "arctic_vixen" GIFs available.</li>';
          }
        })
        .catch(error => {
          console.error('Error fetching "arctic_vixen" GIF list:', error);
        });
    }
  function displayOthersGifList() {
      const othersGifContainer = document.getElementById('othersGifContainer');
      othersGifContainer.style.display = 'block'; // Показати контейнер для pig GIFs

      const gifList = document.getElementById('gifList');
      gifList.innerHTML = ''; // Очистити список

      // Запит до сервера для отримання списку "others" гіфок
      fetch('/Others-gif-list')
        .then(response => response.json())
        .then(data => {
          if (data.length > 0) {
            data.forEach(gif => {
              const listItem = document.createElement('li');
              listItem.innerHTML = `<a href="#" onclick="showGif('${gif._id}')">${gif.filename}</a>`;
              gifList.appendChild(listItem);
            });
          } else {
            gifList.innerHTML = '<li>No "pig" GIFs available.</li>';
          }
        })
        .catch(error => {
          console.error('Error fetching "pig" GIF list:', error);
        });
  }
function searchByName() {
  const searchInput = document.getElementById('searchByNameInput');
  const searchTerm = searchInput.value;

  fetch(`/search-by-name/${searchTerm}`)
    .then(response => response.json())
    .then(data => {
      const gifList = document.getElementById('gifList');
      gifList.innerHTML = '';

      if (data.length > 0) {
        data.forEach(gif => {
          const listItem = document.createElement('li');
          listItem.innerHTML = `<a href="#" onclick="showGif('${gif._id}')">${gif.filename}</a>`;
          gifList.appendChild(listItem);
        });
      } else {
        gifList.innerHTML = '<li>No matching GIFs found.</li>';
      }
    })
    .catch(error => {
      console.error('Error fetching GIF list:', error);
    });
}
function searchByAttribute() {
      const searchByAttributeInput = document.getElementById('searchByAttributeInput');
      const attributeSearchTerm = searchByAttributeInput.value;

      fetch(`/search-by-attribute/${attributeSearchTerm}`)
        .then(response => response.json())
        .then(data => {
          const gifList = document.getElementById('gifList');
          gifList.innerHTML = '';
          if (data.length > 0) {
            data.forEach(gif => {
              const listItem = document.createElement('li');
              listItem.innerHTML = `<a href="#" onclick="showGif('${gif._id}')">${gif.filename}</a>`;
              gifList.appendChild(listItem);
            });
          } else {
            gifList.innerHTML = '<li>No matching GIFs found.</li>';
          }
        })
        .catch(error => {
          console.error('Error fetching GIF list:', error);
        });
    }
  let activeTab = 'main'; // Збереження активної вкладки

  function showTab(tabName) {
  // Зняття класу "active-tab" з поточної активної вкладки
  const currentActiveButton = document.querySelector(`.tab-button[data-tab="${activeTab}"]`);
  currentActiveButton.classList.remove('active-tab');

  // Зняття класу "active-tab" з поточного активного вмісту
  const currentActiveTabContent = document.getElementById(`${activeTab}TabContent`);
  if (currentActiveTabContent) {
    currentActiveTabContent.style.display = 'none';
  }

  // Встановлення класу "active-tab" для нової активної вкладки
  const newActiveButton = document.querySelector(`.tab-button[data-tab="${tabName}"]`);
  newActiveButton.classList.add('active-tab');

  // Оновлення активної вкладки
  activeTab = tabName;
  searchByNameTabContent.style.display = 'none';
  searchByAttributeTabContent.style.display = 'none';
  // Перемикання вкладок
  if (tabName === 'main') {
    displayGifList();
  } else if (tabName === 'comaruFamily') {
    displayComaruGifList();
  } else if (tabName === 'pig') {
    displayPigGifList();
  } else if (tabName === 'others') {
    displayOthersGifList();
  } else if (tabName === 'arctic_vixen') {
    displayArctic_VixenGifList();
  } else if (tabName === 'searchByName') {
    gifList.innerHTML = ''; // Очистити список
    const searchTabContent = document.getElementById(`searchByNameTabContent`);
      searchTabContent.style.display = 'block';
  }
  else if (tabName === 'searchByAttributes') {
    gifList.innerHTML = ''; // Очистити список
    const searchTabContent = document.getElementById(`searchByAttributeTabContent`);
      searchTabContent.style.display = 'block';
  }
}
  </script>
</body>
</html>
